<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>آموزش و آزمون مهندسی نرم‌افزار</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #e5e7eb;
        }
        .telegram-bg {
            background-color: #8774e1;
            background-image: url('https://web.telegram.org/a/assets/patterns/chat-bg-pattern-dark.ad382488d78536d9339d.png');
            background-size: 500px;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.3); }

        .message-bubble-in { background-color: #ffffff; border-radius: 18px 18px 18px 4px; }
        .message-bubble-out { background-color: #eefdde; border-radius: 18px 18px 4px 18px; }
        
        .typing-indicator span {
            height: 8px; width: 8px; background-color: #a0a0a0; display: inline-block;
            border-radius: 50%; animation: typing 1.4s infinite;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 100% { opacity: 0.2; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1); }
        }
        .chat-item.active-chat { background-color: #3390ec; }
        .chat-item.active-chat h3, .chat-item.active-chat p, .chat-item.active-chat span { color: white; }

        /* Quiz Styles */
        .quiz-option {
            background-color: #f0f2f5; border: 2px solid transparent;
            transition: all 0.2s ease-in-out;
        }
        .quiz-option:hover { background-color: #e5e7eb; }
        .quiz-option.selected { border-color: #3b82f6; background-color: #dbeafe; }
        .quiz-option.correct { border-color: #22c55e; background-color: #dcfce7; }
        .quiz-option.incorrect { border-color: #ef4444; background-color: #fee2e2; }
    </style>
</head>
<body class="overflow-hidden">

    <div class="container mx-auto h-screen p-0 md:p-4">
        <div class="flex h-full max-h-full w-full max-w-7xl mx-auto bg-white rounded-none md:rounded-2xl shadow-lg overflow-hidden">

            <!-- Sidebar - Chat List -->
            <aside id="chat-list-container" class="w-full md:w-1/3 lg:w-1/4 h-full bg-[#f0f2f5] border-l border-gray-200 flex flex-col transition-transform duration-300 ease-in-out md:transform-none z-20 md:relative">
                <header class="p-3 border-b border-gray-200 flex items-center gap-3 bg-white">
                     <button id="menu-button" class="p-2 rounded-full hover:bg-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
                    </button>
                    <h1 class="text-lg font-bold text-gray-800">مهندسی نرم‌افزار</h1>
                </header>

                <div class="flex-1 overflow-y-auto custom-scrollbar">
                    <ul id="chat-list">
                        <!-- Chat items will be dynamically inserted here -->
                    </ul>
                </div>
            </aside>

            <!-- Main Content - Chat Window -->
            <main id="main-content" class="flex-1 flex-col h-full telegram-bg hidden md:flex">
                <header class="p-3 border-b border-gray-200/20 flex justify-between items-center bg-white/10 backdrop-blur-sm text-white">
                    <div class="flex items-center">
                        <button id="back-button" class="p-2 rounded-full hover:bg-black/20 md:hidden mr-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg></button>
                        <div id="chat-header-profile" class="flex items-center cursor-pointer">
                            <!-- Header profile content is dynamic -->
                        </div>
                    </div>
                </header>

                <div id="messages-container" class="flex-1 overflow-y-auto p-4 md:p-6 custom-scrollbar">
                    <!-- Messages & Quiz will be injected here by JS -->
                </div>

                <footer id="message-footer" class="p-3 bg-transparent">
                    <div class="flex items-center bg-white p-2 rounded-xl shadow-sm"><input type="text" placeholder="این یک نسخه نمایشی است" class="w-full bg-transparent focus:outline-none px-3 text-gray-700" disabled><button class="p-3 bg-blue-500 text-white rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg></button></div>
                </footer>
            </main>
            
            <div id="placeholder" class="flex-1 h-full telegram-bg flex-col items-center justify-center text-center p-8 text-white hidden md:flex"><div class="bg-black/10 backdrop-blur-md p-6 rounded-2xl"><h2 class="text-2xl font-bold">دوره آموزش مهندسی نرم‌افزار</h2><p class="mt-2 text-gray-200">یک درس را از لیست انتخاب کنید تا یادگیری را شروع کنیم.</p></div></div>
        </div>
    </div>

    <!-- Online Users Counter Script -->
    <script id="_wauz9d">var _wau = _wau || []; _wau.push(["dynamic", "1yzxeoicrj", "z9d", "1c4587ffffff", "small"]);</script><script async src="//waust.at/d.js"></script>
    
    <script>
    // Data is now embedded directly in the HTML file
    const courseData = [
      {
        "id": "intro",
        "title": "معرفی دوره",
        "description": "خوش آمدید! برای شروع اینجا کلیک کنید.",
        "img": "https://placehold.co/100x100/8774E1/FFFFFF?text=👋",
        "status": "آنلاین",
        "messages": [
            { "type": "q", "text": "سلام! به دوره تعاملی مهندسی نرم‌افزار خوش آمدید." },
            { "type": "a", "text": "سلام! ممنون. این دوره چطور کار می‌کنه؟" },
            { "type": "q", "text": "در این دوره، مباحث کلیدی مهندسی نرم‌افزار را در قالب گفتگو یاد می‌گیرید. هر درس یک آزمون کوتاه هم در انتهای خودش داره." },
            { "type": "a", "text": "عالیه! شروع می‌کنم." }
        ],
        "quiz": []
      },
      {
        "id": "lesson1",
        "title": "جلسه ۲: ماهیت نرم افزار",
        "description": "آشنایی با ماهیت، خصوصیات و چالش‌های نرم افزار.",
        "img": "https://placehold.co/100x100/3498DB/FFFFFF?text=L1",
        "messages": [
          { "type": "q", "text": "نرم افزار چه نقش دوگانه ای دارد؟" },
          { "type": "a", "text": "نرم افزار هم نوعی محصول است و همزمان وسیله‌ای برای تحویل یک محصول محسوب می‌شود." },
          { "type": "q", "text": "نرم افزار از چه اجزایی تشکیل شده است؟" },
          { "type": "a", "text": "نرم افزار عبارت است از:<br>- دستورالعمل‌ها (کد برنامه)<br>- ساختمان‌های داده‌ای<br>- اطلاعات توصیفی (مستندات)" },
          { "type": "q", "text": "چرا نرم افزار فرسوده نمی‌شود بلکه زوال می‌یابد؟" },
          { "type": "a", "text": "نرم افزار دچار فرسایش فیزیکی نمی‌شود. اما با هر تغییر و اصلاح، احتمال ورود عیوب جدید وجود دارد که باعث خیز ناگهانی در منحنی آهنگ شکست می‌شود. این فرآیند 'زوال' نامیده می‌شود." },
          { "type": "q", "text": "لایه های مهندسی نرم افزار کدامند؟" },
          { "type": "a", "text": "از پایین به بالا:<br>۱. توجه به کیفیت<br>۲. فرآیندها<br>۳. روش‌ها<br>۴. ابزارها" }
        ],
        "quiz": [
          { "q": "کدام یک جزو اجزای اصلی نرم افزار نیست؟", "o": ["دستورالعمل‌ها", "سخت افزار", "ساختمان‌های داده‌ای", "مستندات"], "a": 1 },
          { "q": "افزایش ناگهانی نرخ شکست نرم افزار پس از اعمال تغییرات چه نام دارد؟", "o": ["فرسودگی", "زوال", "نقص اولیه", "استهلاک"], "a": 1 },
          { "q": "کدام لایه، پایه و اساس سایر لایه‌های مهندسی نرم افزار است؟", "o": ["ابزارها", "روش‌ها", "فرآیندها", "توجه به کیفیت"], "a": 3 }
        ]
      },
      {
        "id": "lesson2",
        "title": "جلسه ۳ و ۴: مدل‌های فرآیند",
        "description": "بررسی مدل‌های تجویزی مانند آبشاری، V و مارپیچی.",
        "img": "https://placehold.co/100x100/8E44AD/FFFFFF?text=L2",
        "messages": [
          { "type": "q", "text": "مدل آبشاری (Waterfall) چیست و چه مشکلاتی دارد؟" },
          { "type": "a", "text": "یک روش سیستماتیک و ترتیبی است. مشکلات اصلی آن:<br>- پروژه‌های واقعی به ندرت ترتیبی هستند.<br>- مشتری باید تا انتهای پروژه برای دیدن نسخه کاری صبر کند." },
          { "type": "q", "text": "مدل V چیست؟" },
          { "type": "a", "text": "نوعی مدل آبشاری است که چگونگی ارتباط کنش‌های وارسی و اعتبارسنجی (آزمون) با کنش‌های قبلی مهندسی (تحلیل و طراحی) را نشان می‌دهد." },
          { "type": "q", "text": "مدل مارپیچی (Spiral) چیست؟" },
          { "type": "a", "text": "یک مدل تکاملی است که ماهیت تکراری مدل نمونه‌سازی را با جنبه‌های کنترلی مدل آبشاری تلفیق می‌کند و بر تحلیل ریسک تاکید دارد." }
        ],
        "quiz": [
          { "q": "کدام مدل، ارتباط بین کنش‌های آزمون و طراحی را به خوبی نشان می‌دهد؟", "o": ["آبشاری", "افزایشی", "V", "مارپیچی"], "a": 2 },
          { "q": "تاکید بر تحلیل ریسک در هر چرخه، از ویژگی‌های اصلی کدام مدل است؟", "o": ["تکاملی", "افزایشی", "مارپیچی", "همروند"], "a": 2 },
          { "q": "استفاده از Use Case ها از ویژگی‌های اصلی کدام فرآیند است؟", "o": ["فرآیند یکپارچه", "مدل مارپیچی", "مدل V", "مدل آبشاری"], "a": 0 }
        ]
      },
      {
        "id": "lesson3",
        "title": "جلسه ۵ و ۶: توسعه چابک (Agile)",
        "description": "بررسی فلسفه و اصول چابکی و معرفی مدل های XP و اسکرام.",
        "img": "https://placehold.co/100x100/E67E22/FFFFFF?text=L3",
        "messages": [
          { "type": "q", "text": "بیانیه چابک (Agile Manifesto) بر چه ارزش‌هایی تأکید دارد؟" },
          { "type": "a", "text": "برتری موارد زیر را اعلام می‌کند:<br>- افراد و تعامل‌ها بر فرآیندها<br>- نرم افزار عملیاتی بر مستندات جامع<br>- همکاری با مشتری بر قرارداد<br>- پاسخ به تغییر بر دنبال کردن برنامه" },
          { "type": "q", "text": "برنامه نویسی جفتی (Pair Programming) چگونه انجام می‌شود؟" },
          { "type": "a", "text": "دو نفر همزمان پشت یک کامپیوتر کار می‌کنند. یک نفر به عنوان 'راننده' (Driver) کد را می‌نویسد و نفر دیگر به عنوان 'ناوبر' (Navigator) کد را بررسی می‌کند." },
          { "type": "q", "text": "اسکرام (Scrum) چیست؟" },
          { "type": "a", "text": "یک چارچوب برای توسعه چابک است که نرم افزار در دوره‌هایی به نام اسپرینت (Sprint) توسعه پیدا می‌کند که معمولاً ۲ تا ۴ هفته طول می‌کشد." }
        ],
        "quiz": [
          { "q": "کدام یک از ارزش‌های اصلی بیانیه چابک نیست؟", "o": ["افراد و تعامل‌ها", "نرم افزار عملیاتی", "دنبال کردن یک برنامه", "همکاری با مشتری"], "a": 2 },
          { "q": "در روش برنامه نویسی جفتی، فردی که کد را می‌نویسد چه نام دارد؟", "o": ["ناوبر (Navigator)", "راننده (Driver)", "معمار (Architect)", "آزمونگر (Tester)"], "a": 1 },
          { "q": "دوره‌های زمانی ۲ تا ۴ هفته‌ای در اسکرام چه نامیده می‌شوند؟", "o": ["ایترشن", "اسپرینت", "ریلیز", "مایلستون"], "a": 1 }
        ]
      },
      {
        "id": "lesson4",
        "title": "جلسه ۷: اصول راهنما",
        "description": "مروری بر اصول هسته‌ای، راهنمای فرآیند و فعالیت‌های چارچوبی.",
        "img": "https://placehold.co/100x100/16A085/FFFFFF?text=L4",
        "messages": [
          { "type": "q", "text": "اصل 'Keep it simple' جزو کدام دسته از اصول است؟" },
          { "type": "a", "text": "این اصل جزو اصول هسته‌ای مهندسی نرم افزار است." },
          { "type": "q", "text": "قواعد اصلی آزمون چیست؟" },
          { "type": "a", "text": "<b>قواعد:</b><br>- آزمون فرایند اجرای برنامه به قصد یافتن خطا است.<br>- آزمون موفق، آزمونی است که یک خطای جدید را کشف کند." },
          { "type": "q", "text": "اصل پارتو در آزمون بیانگر چیست؟" },
          { "type": "a", "text": "این اصل بیان می‌کند که ۸۰% خطاها در ۲۰% از مؤلفه‌های نرم‌افزار یافت می‌شوند." }
        ],
        "quiz": [
          { "q": "اصل 'Keep it simple' جزو کدام دسته از اصول است؟", "o": ["راهنمای فرآیند", "ارتباطی", "هسته‌ای", "برنامه‌ریزی"], "a": 2 },
          { "q": "کدام یک از موارد زیر جزو قواعد آزمون است؟", "o": ["آزمون کامل امکان‌پذیر نیست", "آزمون موفق خطای جدید کشف می‌کند", "آزمون از کوچک به بزرگ است", "اصل پارتو کاربرد دارد"], "a": 1 },
          { "q": "اصل پارتو در آزمون بیانگر چیست؟", "o": ["آزمون کامل نیست", "آزمون از کوچک به بزرگ است", "۸۰% خطاها در ۲۰% مؤلفه‌ها یافت می‌شوند", "آزمون باید قابل رهگیری باشد"], "a": 2 }
        ]
      }
    ];

    document.addEventListener('DOMContentLoaded', function () {
        // DOM Elements
        const chatList = document.getElementById('chat-list');
        const messagesContainer = document.getElementById('messages-container');
        const chatHeaderProfile = document.getElementById('chat-header-profile');
        const mainContent = document.getElementById('main-content');
        const placeholder = document.getElementById('placeholder');
        const chatListContainer = document.getElementById('chat-list-container');
        const backButton = document.getElementById('back-button');
        const menuButton = document.getElementById('menu-button');
        const messageFooter = document.getElementById('message-footer');

        // State
        let currentChatId = null;
        let messageQueue = [];
        let isTyping = false;
        let quizState = { active: false, questions: [], currentQ: 0, score: 0 };
        
        // Functions
        const populateChatList = () => {
            chatList.innerHTML = ''; // Clear existing list
            courseData.forEach(chat => {
                const li = document.createElement('li');
                li.className = 'chat-item';
                li.dataset.chat = chat.id;
                li.innerHTML = `
                    <div class="flex items-center p-3 cursor-pointer hover:bg-gray-200 border-b">
                        <img class="w-12 h-12 rounded-full ml-3 object-cover" src="${chat.img}" alt="${chat.title}">
                        <div class="flex-1 overflow-hidden">
                            <h3 class="font-semibold">${chat.title}</h3>
                            <p class="text-sm text-gray-600 truncate">${chat.description}</p>
                        </div>
                    </div>
                `;
                chatList.appendChild(li);
            });
            // Add event listeners after populating
            document.querySelectorAll('.chat-item').forEach(item => item.addEventListener('click', () => switchChat(item.dataset.chat)));
        };
        
        const createMessageBubble = (msg) => {
            const bubbleWrapper = document.createElement('div');
            const bubble = document.createElement('div');
            // Question on the left (in), Answer on the right (out)
            const isQuestion = msg.type === 'q';
            bubbleWrapper.className = `flex mb-4 animate-fade-in ${isQuestion ? 'justify-start' : 'justify-end'}`;
            bubble.className = `p-3 max-w-lg shadow text-gray-800 ${isQuestion ? 'message-bubble-in' : 'message-bubble-out'}`;
            bubble.innerHTML = `<strong>${isQuestion ? 'سوال' : 'پاسخ'}:</strong><br>${msg.text}`;
            bubbleWrapper.appendChild(bubble);
            return bubbleWrapper;
        };

        const showTypingIndicator = (isIncoming) => {
            if (document.getElementById('typing-indicator')) return;
            const indicator = document.createElement('div');
            indicator.id = 'typing-indicator';
            indicator.className = `flex mb-4 animate-fade-in ${isIncoming ? 'justify-start' : 'justify-end'}`;
            indicator.innerHTML = `
                <div class="${isIncoming ? 'message-bubble-in' : 'message-bubble-out'} p-3 max-w-lg shadow flex items-center gap-1">
                    <div class="typing-indicator"><span></span><span></span><span></span></div>
                </div>`;
            messagesContainer.appendChild(indicator);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        };
        
        const removeTypingIndicator = () => {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
        };

        const processMessageQueue = () => {
            if (messageQueue.length === 0) {
                isTyping = false;
                const currentChat = courseData.find(c => c.id === currentChatId);
                if (currentChat && currentChat.quiz && currentChat.quiz.length > 0) {
                    showStartQuizButton();
                }
                return;
            }
            isTyping = true;
            const nextMessage = messageQueue.shift();
            showTypingIndicator(nextMessage.type === 'q');
            
            setTimeout(() => {
                removeTypingIndicator();
                const bubble = createMessageBubble(nextMessage);
                messagesContainer.appendChild(bubble);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                processMessageQueue();
            }, Math.random() * 1500 + 800); // Slower typing
        };
        
        const showStartQuizButton = () => {
            const buttonWrapper = document.createElement('div');
            buttonWrapper.className = 'flex justify-center my-4 animate-fade-in';
            buttonWrapper.innerHTML = `<button id="start-lesson-quiz" class="bg-blue-500 text-white font-bold py-2 px-6 rounded-full hover:bg-blue-600 transition-transform transform hover:scale-105">شروع آزمون این درس</button>`;
            messagesContainer.appendChild(buttonWrapper);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            document.getElementById('start-lesson-quiz').addEventListener('click', startLessonQuiz);
        };

        const switchChat = (chatId) => {
            if (isTyping) return;
            currentChatId = chatId;
            quizState.active = false;
            messageFooter.classList.remove('hidden');
            messagesContainer.innerHTML = '';
            
            const chatInfo = courseData.find(c => c.id === chatId);
            if (!chatInfo) return;

            chatHeaderProfile.innerHTML = `
                <img class="w-10 h-10 rounded-full object-cover ml-3" src="${chatInfo.img}" alt="${chatInfo.title}">
                <div>
                    <h2 class="text-lg font-semibold">${chatInfo.title}</h2>
                    <p class="text-xs text-gray-300">${chatInfo.status || 'آنلاین'}</p>
                </div>
            `;
            
            document.querySelectorAll('.chat-item').forEach(item => item.classList.toggle('active-chat', item.dataset.chat === chatId));
            
            mainContent.classList.remove('hidden'); mainContent.classList.add('flex');
            placeholder.classList.add('hidden'); placeholder.classList.remove('md:flex');
            if (window.innerWidth < 768) { chatListContainer.classList.add('hidden'); }

            messageQueue = [...chatInfo.messages];
            processMessageQueue();
        };

        const startLessonQuiz = () => {
            const chatInfo = courseData.find(c => c.id === currentChatId);
            if (!chatInfo || !chatInfo.quiz) return;

            quizState.active = true;
            messageFooter.classList.add('hidden');
            document.getElementById('start-lesson-quiz')?.parentElement.remove();

            const shuffled = [...chatInfo.quiz].sort(() => 0.5 - Math.random());
            quizState.questions = shuffled;
            quizState.currentQ = 0;
            quizState.score = 0;

            const startBubble = document.createElement('div');
            startBubble.className = 'message-bubble-in p-4 text-center animate-fade-in';
            startBubble.innerHTML = `<h3 class="text-xl font-bold mb-2">آزمون '${chatInfo.title}' شروع شد!</h3><p>موفق باشید!</p>`;
            messagesContainer.appendChild(startBubble);
            
            setTimeout(displayQuizQuestion, 2000);
        };

        const displayQuizQuestion = () => {
            if (quizState.currentQ >= quizState.questions.length) {
                showQuizResult();
                return;
            }
            const q = quizState.questions[quizState.currentQ];
            const questionBubble = document.createElement('div');
            questionBubble.className = 'message-bubble-in p-4 w-full animate-fade-in';
            let optionsHTML = q.o.map((opt, index) => 
                `<button data-index="${index}" class="quiz-option w-full text-right p-3 my-1 rounded-lg font-semibold">${opt}</button>`
            ).join('');

            questionBubble.innerHTML = `
                <p class="mb-3 font-bold text-md">سوال ${quizState.currentQ + 1} از ${quizState.questions.length}: ${q.q}</p>
                <div class="options-container">${optionsHTML}</div>
            `;
            messagesContainer.appendChild(questionBubble);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            document.querySelectorAll('.quiz-option').forEach(btn => {
                btn.addEventListener('click', handleAnswer);
            });
        };

        const handleAnswer = (e) => {
            const selectedIndex = parseInt(e.target.dataset.index);
            const question = quizState.questions[quizState.currentQ];
            const options = e.target.parentElement.querySelectorAll('.quiz-option');

            options.forEach(opt => opt.disabled = true);

            if (selectedIndex === question.a) {
                quizState.score++;
                e.target.classList.add('correct');
            } else {
                e.target.classList.add('incorrect');
                options[question.a].classList.add('correct');
            }

            quizState.currentQ++;
            setTimeout(displayQuizQuestion, 2000);
        };

        const showQuizResult = () => {
            const score = quizState.score;
            const total = quizState.questions.length;
            const percentage = Math.round((score / total) * 100);
            let message = `عالی بود! شما به ${score} سوال از ${total} پاسخ صحیح دادید. (${percentage}%)`;
            if (percentage < 50) message = `نیاز به تلاش بیشتری دارید. شما به ${score} سوال از ${total} پاسخ صحیح دادید. (${percentage}%)`;
            else if (percentage < 80) message = `خوب بود! شما به ${score} سوال از ${total} پاسخ صحیح دادید. (${percentage}%)`;
            
            const resultBubble = document.createElement('div');
            resultBubble.className = 'message-bubble-in p-4 text-center animate-fade-in';
            resultBubble.innerHTML = `
                <h3 class="text-xl font-bold mb-2">آزمون تمام شد!</h3>
                <p class="mb-4">${message}</p>
                <button id="restart-quiz-btn" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-full hover:bg-blue-600">بازگشت به لیست دروس</button>
            `;
            messagesContainer.appendChild(resultBubble);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            document.getElementById('restart-quiz-btn').addEventListener('click', () => switchChat('intro'));
        };

        // Event Listeners & Initial Setup
        backButton.addEventListener('click', () => {
            chatListContainer.classList.remove('hidden');
            mainContent.classList.add('hidden'); mainContent.classList.remove('flex');
        });
        menuButton.addEventListener('click', () => alert('منو در حال ساخت است!'));

        const style = document.createElement('style');
        style.innerHTML = `@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } } .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }`;
        document.head.appendChild(style);
        
        const initApp = () => {
            populateChatList();
            if (window.innerWidth >= 768) {
                placeholder.classList.remove('hidden');
                mainContent.classList.add('hidden');
            } else {
                mainContent.classList.add('hidden');
                placeholder.classList.add('hidden');
                switchChat('intro'); // On mobile, show a chat by default
            }
        };

        initApp();
    });
    </script>
</body>
</html>
